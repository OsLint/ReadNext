<!DOCTYPE html>
<html lang="en">
<head>
    <title>Books For You</title>
    <meta charset="UTF-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1"/>
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Raleway"/>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css"/>
    <link rel="stylesheet" href="/static/styles.css"/>
    <script>
        function handleImageError(image) {
            image.onerror = null;
            image.src = '/static/placeholder.jpg';
        }

        function likeBook(bookId) {
            fetch('/like_book', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({ book_id: bookId })
            })
            .then(response => response.json())
            .then(data => {
                if (data.likes !== undefined) {
                    const likeButton = document.querySelector(`.book-card[data-book-id="${bookId}"] .like-button`);
                    likeButton.textContent = `Liked (${data.likes})`;
                    likeButton.style.backgroundColor = 'darkslategray';
                } else {
                    alert(data.message || 'Error liking book.');
                }
            })
            .catch(error => {
                console.error('Error:', error);
            });
        }
    </script>
</head>
<body style="background-color: #f1f1f1; font-family: 'Raleway', sans-serif; max-width: 1600px; margin: auto;">
<!-- Sidebar/menu -->
<nav style="position: fixed; width: 300px; background-color: white; z-index: 3; height: 100%; overflow-y: auto;">
    <div style="padding: 16px;">
        <a href="{{ url_for('home') }}" title="Go to home page">
            <img src="/static/books_for_you_logo.png" style="width: 35%; border-radius: 50%;" alt="logo of the app"/>
        </a><br/><br/>
        <h4><b>Menu</b></h4>
        <p style="color: grey;">Welcome To Books For You!</p>
    </div>
    <div style="display: block;">
        <a href="{{ url_for('home') }}" style="padding: 16px; display: block; color: teal; text-decoration: none;">
            <i class="fa fa-th-large fa-fw" style="margin-right: 8px;"></i>Explore
        </a>
        <a href="{{ url_for('profile') }}" style="padding: 16px; display: block; color: teal; text-decoration: none;">
            <i class="fa fa-user fa-fw" style="margin-right: 8px;"></i>Profile
        </a>
        <a href="" style="padding: 16px; display: block; color: teal; text-decoration: none;">
            <i class="fa fa-envelope fa-fw" style="margin-right: 8px;"></i>Get Recommendation
        </a>
    </div>
</nav>

<div style="margin-left: 300px; padding: 16px;">
    <!-- Header -->
    <header id="explore">
        <div>
            <h1><b>Explore</b></h1>
            <div style="border-bottom: 1px solid #ccc; padding: 16px 0;">
                <form method="GET" action="{{ url_for('home') }}">
                    <label>
                        <input type="text" name="title" placeholder="Search by title"
                               style="padding: 8px; margin-right: 8px;">
                    </label>
                    <label>
                        <input type="text" name="author" placeholder="Search by author"
                               style="padding: 8px; margin-right: 8px;">
                    </label>
                    <label>
                        <input type="number" name="year" placeholder="Search by year"
                               style="padding: 8px; margin-right: 8px;">
                    </label>
                    <label>
                        <input type="text" name="genre" placeholder="Search by genre"
                               style="padding: 8px; margin-right: 8px;">
                    </label>
                    <button type="submit" style="padding: 8px;">Search</button>
                </form>
            </div>
        </div>
    </header>

    <div class="book-grid">
        {% for book in books %}
            <div class="book-card" data-book-id="{{ book.id }}">
                <img src="{{ book.cover_photo_url }}" alt="Book cover" onerror="handleImageError(this)"/>
                <h3>{{ book.title }}</h3>
                <p>{{ book.author }}</p>
                <p><strong>Short Description:</strong></p>
                <p>{{ book.short_description.split(' ')[:100] | join(' ') }}...</p>
                <p><strong>Genre:</strong> {{ book.genre }}</p>
                <p><strong>Year:</strong> {{ book.publication_year }}</p>
                <button class="like-button" onclick="likeBook({{ book.id }})"
                        style="background-color: {% if book.liked_by_user %}darkslategray{% else %}teal{% endif %}; color: white; padding: 8px 16px; border: none;">
                    {% if book.liked_by_user %}Liked{% else %}Like{% endif %} ({{ book.likes }})
                </button>
            </div>
        {% endfor %}
    </div>

    <div style="text-align: center; padding: 32px;">
        <div>
            {% if page > 1 %}
                <a href="{{ url_for('home', page=page-1) }}"
                   style="padding: 8px 16px; border: 1px solid #ccc; text-decoration: none; color: black;">«</a>
            {% endif %}
            <span style="padding: 8px 16px; background-color: black; color: white; text-decoration: none;">{{ page }}</span>
            {% if books|length == 5 %}
                <a href="{{ url_for('home', page=page + 1) }}"
                   style="padding: 8px 16px; border: 1px solid #ccc; text-decoration: none; color: black;">»</a>
            {% endif %}
        </div>
    </div>

    <div style="padding: 32px; margin-bottom: 32px; background-color: white;">
        <h4><b>How It Works?</b></h4>

        <footer style="background-color: #333; color: white; padding: 32px;">
            <div style="display: flex; flex-wrap: wrap;">
                <div style="flex: 1; padding: 16px;">
                    <h3>Rate Books</h3>
                    <p>Share your thoughts and help others find their next favorite read!</p>
                </div>

                <div style="flex: 1; padding: 16px;">
                    <h3>Get Recommendations</h3>
                    <p>Personalized book suggestions tailored just for you! Using the newest machine learning model the
                        KNN!</p>
                </div>

                <div style="flex: 1; padding: 16px;">
                    <h3>Discover New Books</h3>
                    <p>Explore the latest releases and hidden gems!</p>
                </div>
            </div>
        </footer>

        <div style="background-color: black; color: white; text-align: center; padding: 24px;">Oskar Kalbarczyk s27773
        </div>
    </div>
</div>
</body>
</html>
